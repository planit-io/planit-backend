auth.provider=keycloak  # oppure keycloak

# =====================================================
# ??  TryPly Backend - Quarkus 3.20.x LTS Configuration
# =====================================================

# --- App Metadata ---
quarkus.application.name=planit-backend
quarkus.application.version=1.0.0
quarkus.application.description=Plan-It Backend Service
quarkus.application.vendor=Plan-It
quarkus.application.license=MIT
quarkus.application.license-url=https://opensource.org/licenses/MIT
quarkus.http.port=${BE_PORT:8081}

# =====================================================
# ? Database (PostgreSQL)
# =====================================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USER:planit}
quarkus.datasource.password=${DB_PASSWORD:planit}
quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5432/planitydb}
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.sql-load-script=no-file

quarkus.hibernate-orm.physical-naming-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy

quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration
quarkus.flyway.schemas=public


# =====================================================
# ? Security / JWT / Keycloak
# =====================================================
mp.jwt.verify.publickey.location=${KEYCLOAK_PUBLIC_KEY_URL:http://localhost:8080/realms/planit/protocol/openid-connect/certs}
mp.jwt.verify.issuer=${KEYCLOAK_ISSUER_URL:http://localhost:8080/realms/planit}
quarkus.oidc.auth-server-url=${KEYCLOAK_URL:http://localhost:8080/realms/planit}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID:planit-backend}
#quarkus.oidc.credentials.secret=${KEYCLOAK_CLIENT_SECRET:}
quarkus.oidc.tls.verification=none
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.devui-enabled=false

# consenti accesso pubblico a Swagger / OpenAPI
quarkus.http.auth.permission.swagger.paths=/q/swagger-ui,/q/swagger-ui/*,/q/openapi,/q/openapi/*
quarkus.http.auth.permission.swagger.policy=permit

# Richiede autenticazione per tutte le API REST
quarkus.http.auth.permission.all.paths=/api/*
quarkus.http.auth.permission.all.policy=authenticated

quarkus.http.auth.permission.public.paths=/public/*,/health,/api/users/sync
quarkus.http.auth.permission.public.policy=permit

mp.openapi.filter=com.planit.config.GlobalSecurityFilter

# =====================================================
# ? OpenAPI / Swagger UI
# =====================================================
quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.path=/q/swagger-ui
quarkus.swagger-ui.theme=original

# Abilita sempre Swagger UI
quarkus.swagger-ui.always-include=true

# Definisci lo schema di sicurezza globale come JWT Bearer
quarkus.smallrye-openapi.security-scheme=jwt
quarkus.smallrye-openapi.security-scheme-name=JWT
quarkus.smallrye-openapi.security-scheme-description=JWT authentication
quarkus.smallrye-openapi.security-scheme-bearer-format=JWT
quarkus.smallrye-openapi.security-scheme-in=header
quarkus.smallrye-openapi.security-scheme-key-name=Authorization


# =====================================================
# ? Dev Settings
# =====================================================
quarkus.live-reload.password=dev
quarkus.devservices.enabled=${QUARKUS_DEV:true}
quarkus.log.category."org.hibernate.SQL".level=DEBUG
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n


